<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="index.css">
    <title>Public Invention Ox</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.socket.io/4.2.0/socket.io.min.js"
        integrity="sha384-PiBR5S00EtOj2Lto9Uu81cmoyZqR57XcOna1oAuVuIEjzj0wpqDVfD0JA9eXlRsj"
        crossorigin="anonymous"></script>
</head>

<body>
    <h1>Ox Web</h1>

    <div id="myDiv" style="width:600px;height:600px;"></div>

    <script>

        myDiv = document.getElementById('myDiv');

        var data = [{
            x: [0],
            y: [0],
            mode: 'lines',
            line: { color: '#80CAF6' }
        }]

        Plotly.newPlot('myDiv', data);



        // Socket IO
        var socket = io();
        socket.on("connect", () => {
            console.log("connected");
            console.log(socket.id);
            socket.on('plot', (msg) => {
                console.log('plot: ' + JSON.stringify(msg));
                /*var minuteView = {
                    xaxis: {
                        type: 'date',
                        range: [olderTime, futureTime]
                    },
                    yaxis: {
                        range: [-amp * 1.1, amp * 1.1]
                    }
                };*/

                var update = {
                    x: [[msg.t]],
                    y: [[msg.y]]//[[rand()]]
                }

                //Plotly.relayout('myDiv', minuteView);
                Plotly.extendTraces('myDiv', update, [0])
            });
        });

        socket.on("connect_error", (error) => {
            console.error(error);
        });

        socket.on("disconnect", () => {
            console.log("disconnected");
            console.log(socket.id);
        });

    </script>

    <!--<script>
        // Plot demo
        myDiv = document.getElementById('myDiv');

        function rand() {
            return Math.random();
        }

        var time = new Date();

        var data = [{
            x: [time],
            y: [rand],
            mode: 'lines',
            line: { color: '#80CAF6' }
        }]

        Plotly.newPlot('myDiv', data);

        var cnt = 0;
        let rate = 100;
        let freq = 0.1; // Hz
        let amp = 2; // amplitude

        let d_0 = new Date();
        let t_0 = d_0.getTime();

        var interval = setInterval(function () {

            var time = new Date();
            let t = (time.getTime() - t_0) / 1000;
            let w = 2 * Math.PI * freq;
            var y_val = amp * Math.sin(w * (t));
            //console.log(t);
            var update = {
                x: [[time]],
                y: [[y_val]]//[[rand()]]
            }

            var olderTime = time.setMinutes(time.getMinutes() - 1);
            var futureTime = time.setMinutes(time.getMinutes() + 1);

            var minuteView = {
                xaxis: {
                    type: 'date',
                    range: [olderTime, futureTime]
                },
                yaxis: {
                    range: [-amp*1.1, amp*1.1]
                }
            };

            Plotly.relayout('myDiv', minuteView);
            Plotly.extendTraces('myDiv', update, [0])

            if (++cnt === 10000) clearInterval(interval);
        }, rate);
    </script>-->
</body>

</html>